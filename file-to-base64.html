<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Convert file to Base64</title>
    <link rel="stylesheet" href="./new.min.css">
    <style>
      #from-base64 input {width: 100% }
    </style>
  </head>
  <body>
    <div id="to-base64">
      <input type="file" />
      <h3>Base64:</h3>
      <pre></pre>
      <button>copy</button>
    </div>
    <hr>
    <div id="from-base64">
      <input type="text" placeholder="Insert Base64 here"/>
      <h3>File:</h3>
      <div>
        <a download="ecp.zip" href="data:application/x-zip-compressed;base64,UEsDB">Download</a>
      <div>
    </div>
    
  <script>
  
  // File to Base64

  const fileInput = document.querySelector('#to-base64 input');
  const contentElement = document.querySelector('#to-base64 pre');
  const copyButton = document.querySelector('#to-base64 button');

  fileInput.addEventListener('change', e => {
    contentElement.textContent = 'Loading...';
    const reader = new FileReader();
    reader.onload = e => {
      try {
        const data = new Uint8Array(e.target.result);
        let s = '';
        for (let d of data) {
          s += String.fromCharCode(d);
        }
        contentElement.textContent = btoa(s);
      } catch(e) {
        contentElement.textContent = e.toString();
      }
    }
    try {
      reader.readAsArrayBuffer(e.target.files[0]);
    } catch(e) {
      contentElement.textContent = e.toString();
    }
  }, false);

  copyButton.addEventListener('click', e => {
    const text = contentElement.textContent;
    navigator.clipboard.writeText(text);
  });
  
  // Base64 to file
  
  const textInput = document.querySelector('#from-base64 input');
  const downloadElement = document.querySelector('#from-base64 a');
  textInput.addEventListener('change', event => {
    const base64 = event.target.value;
    const isZip = base64.startsWith('UEs');
    downloadElement.download = 'file' + (isZip ? '.zip' : '');
    const type = isZip ? 'application/x-zip-compressed' : 'application/octet-stream';
    downloadElement.href = `data:${type};base64,${base64}`;
  });
  

  </script>

</body>

</html>